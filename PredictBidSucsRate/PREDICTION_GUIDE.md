# 입찰 투찰률 예측 시스템 사용 가이드

## 개요
이 시스템은 학습된 머신러닝 모델을 사용하여 새로운 입찰공고의 업체투찰률, 예가투찰률, 참여업체수를 예측합니다.

## 사전 준비

### 1. 모델 훈련
먼저 `bid.ml.train.py`를 실행하여 모델을 훈련시켜야 합니다:

```bash
cd PredictBidSucsRate
python bid.ml.train.py
```

### 2. 필요한 파일들
훈련 완료 후 다음 파일들이 `res/` 폴더에 생성되어야 합니다:
- `mlpregr.model1.v0.1.1.npz` (업체투찰률 예측 모델)
- `mlpregr.model2.v0.1.1.npz` (예가투찰률 예측 모델)
- `mlpregr.model3.v0.1.1.npz` (참여업체수 예측 모델)
- `mlpregr.tokenizer.v0.1.1.npz` (형태소 분석기)
- `mlpregr.vectorizer.v0.1.1.npz` (TF-IDF 벡터화기)
- `x_fited_scaler.v2.npz` (정규화 도구)

## 사용법

### 1. 기본 사용법 (참여업체수 포함)
```bash
python predict_new_data.py [데이터파일명.csv]
```

### 2. 참여업체수 없는 예측 (새로운 방식)
```bash
python predict_without_participant.py [데이터파일명.csv]
```

### 3. 예시
```bash
# 참여업체수 포함 샘플 데이터로 예측
python predict_new_data.py sample_prediction_data.csv

# 참여업체수 없는 샘플 데이터로 예측
python predict_without_participant.py sample_prediction_data_no_participant.csv

# 실제 데이터로 예측
python predict_new_data.py new_bid_data.csv
python predict_without_participant.py new_bid_data.csv
```

## 입력 데이터 형식

### 1. 참여업체수 포함 데이터 (기본 방식)

#### 필수 컬럼
| 컬럼명 | 설명 | 데이터 타입 | 예시 |
|--------|------|-------------|------|
| 입찰번호 | 입찰 고유 번호 | 문자열 | "2024-001" |
| 입찰차수 | 입찰 차수 | 정수 | 1 |
| 기초금액 | 기초 금액 (원) | 정수 | 1000000000 |
| 낙찰하한률 | 낙찰 하한률 | 실수 | 0.85 |
| 참여업체수 | 참여 업체 수 | 정수 | 5 |
| 간접비 | 간접비 (원) | 정수 | 100000000 |
| 순공사원가 | 순공사원가 (원) | 정수 | 750000000 |
| 면허제한코드 | 면허 제한 코드 | 문자열 | "001" |
| 공고기관코드 | 공고 기관 코드 | 문자열 | "1001" |
| 주공종명 | 주공종명 | 문자열 | "건축공사" |
| 공고기관명 | 공고 기관명 | 문자열 | "서울특별시청" |
| 공사지역 | 공사 지역 | 문자열 | "서울특별시" |
| 키워드 | 키워드 | 문자열 | "건물 신축 공사" |

### 2. 참여업체수 없는 데이터 (새로운 방식)

#### 필수 컬럼
| 컬럼명 | 설명 | 데이터 타입 | 예시 |
|--------|------|-------------|------|
| 입찰번호 | 입찰 고유 번호 | 문자열 | "2024-001" |
| 입찰차수 | 입찰 차수 | 정수 | 1 |
| 기초금액 | 기초 금액 (원) | 정수 | 1000000000 |
| 낙찰하한률 | 낙찰 하한률 | 실수 | 0.85 |
| 간접비 | 간접비 (원) | 정수 | 100000000 |
| 순공사원가 | 순공사원가 (원) | 정수 | 750000000 |
| 면허제한코드 | 면허 제한 코드 | 문자열 | "001" |
| 공고기관코드 | 공고 기관 코드 | 문자열 | "1001" |
| 주공종명 | 주공종명 | 문자열 | "건축공사" |
| 공고기관명 | 공고 기관명 | 문자열 | "서울특별시청" |
| 공사지역 | 공사 지역 | 문자열 | "서울특별시" |
| 키워드 | 키워드 | 문자열 | "건물 신축 공사" |

**참고**: 참여업체수는 예측 대상이므로 입력 데이터에 포함하지 않습니다.

### 선택적 컬럼
다음 컬럼들은 선택사항이며, 없으면 기본값으로 처리됩니다:
- 낙찰금액, 업체투찰률, 예가투찰률, 투찰률오차
- 예정금액, 낙찰하한가
- 공고기관점수, 공사지역점수, 키워드점수

## 출력 결과

### 1. 예측 결과
예측 완료 후 다음 컬럼들이 추가됩니다:
- `업체투찰률예측`: 예측된 업체 투찰률
- `예가투찰률예측`: 예측된 예가 투찰률
- `참여업체수예측`: 예측된 참여 업체 수
- `예정금액예측`: 예가투찰률로 계산된 예정금액
- `낙찰금액(업체투찰률)예측`: 업체투찰률로 계산된 낙찰금액
- `A값여부`: 업체투찰률이 0.8 이상이면 'O'

### 2. 결과 파일
예측 결과는 `res/prediction_[원본파일명].xlsx` 파일로 저장됩니다.

## 문제 해결

### 1. 모델 로드 실패
```
❌ 모델 로드 실패: [오류 메시지]
```
**해결방법**: 먼저 `bid.ml.train.py`를 실행하여 모델을 훈련시켜주세요.

### 2. 컬럼 누락
```
⚠️  누락된 컬럼들: ['공고기관명', '키워드']
```
**해결방법**: 누락된 컬럼들은 기본값으로 채워집니다. 필요시 데이터를 수정하세요.

### 3. 정규화 실패
```
❌ 정규화 실패: [오류 메시지]
```
**해결방법**: 
- 훈련 시 사용한 특성 수와 현재 데이터의 특성 수가 일치하는지 확인
- 데이터에 결측값이나 무한값이 있는지 확인

### 4. 예측 실패
```
❌ 업체투찰률 예측 실패: [오류 메시지]
```
**해결방법**: 
- 입력 데이터의 형식이 올바른지 확인
- 모델이 올바르게 로드되었는지 확인

## 성능 최적화

### 1. 대용량 데이터 처리
- 대용량 데이터의 경우 배치 단위로 나누어 처리
- 메모리 사용량 모니터링

### 2. 정확도 향상
- 더 많은 훈련 데이터 사용
- 특성 엔지니어링 개선
- 모델 하이퍼파라미터 튜닝

## 주의사항

1. **데이터 형식**: 모든 숫자 데이터는 쉼표 없이 입력
2. **인코딩**: CSV 파일은 UTF-8 인코딩으로 저장
3. **결측값**: 결측값은 빈 문자열('') 또는 0으로 처리
4. **특수문자**: 텍스트 데이터의 특수문자는 자동으로 처리됨

## 테스트

### 1. 기본 시스템 테스트
```bash
python test_prediction.py
```

### 2. 참여업체수 없는 시스템 테스트
```bash
python test_prediction_no_participant.py
```

## 예시 데이터

- `sample_prediction_data.csv`: 참여업체수 포함 샘플 데이터
- `sample_prediction_data_no_participant.csv`: 참여업체수 없는 샘플 데이터

## 지원

문제가 발생하면 다음을 확인해주세요:
1. 모델이 올바르게 훈련되었는지
2. 입력 데이터 형식이 올바른지
3. 필요한 파일들이 모두 존재하는지
4. Python 환경과 라이브러리가 올바르게 설치되었는지
